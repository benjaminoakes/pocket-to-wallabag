<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket to Wallabag Converter</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Pocket to Wallabag Converter</h1>
            <p>A <a href="https://getoffpocket.com/">getoffpocket.com</a> project</p>
            <p>Convert your Pocket export to Wallabag-compatible format</p>
            <div class="format-info">
                <span class="format-badge">üìÑ Exports as Instapaper CSV format</span>
                <span class="compatibility-note">Compatible with Wallabag import</span>
            </div>
            <div class="privacy-badges">
                <span class="badge privacy-badge">üîí 100% Client-Side Processing</span>
                <span class="badge opensource-badge">üìñ Open Source (üêô <a href="https://github.com/benjaminoakes/pocket-to-wallabag/">GitHub</a>, 3Ô∏è‚É£ <a href="LICENSE.txt">GPLv3</a>)</span>
            </div>
        </header>
        <div  class="privacy-notice">
        <h4 style="text-align: center">üì¢ Did this converter help you?  Please share it with others!</h4>
        </div>
        <!---
        <div class="buttons is-centered">
          <button id="native-share-btn" class="button is-success" onclick="shareNatively()" style="display: none;">
            <span class="icon">
              <i class="fas fa-share"></i>
            </span>
            <span>Share</span>
          </button>
          <button id="copy-share-btn" class="button is-warning" onclick="copyToShare()" style="display: none;">
            <span class="icon">
              <i class="fas fa-copy"></i>
            </span>
            <span>Copy Link</span>
          </button>
          <a href="https://twitter.com/intent/tweet?text=Compare%20Pocket%20alternatives&url=https://getoffpocket.com" target="_blank" class="button is-info">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>
            <span>Twitter</span>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://getoffpocket.com" target="_blank" class="button is-primary">
            <span class="icon">
              <i class="fab fa-facebook"></i>
            </span>
            <span>Facebook</span>
          </a>
          <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://getoffpocket.com" target="_blank" class="button is-link">
            <span class="icon">
              <i class="fab fa-linkedin"></i>
            </span>
            <span>LinkedIn</span>
          </a>
          <a href="https://reddit.com/submit?url=https://getoffpocket.com&title=Compare%20Pocket%20alternatives" target="_blank" class="button is-warning">
            <span class="icon">
              <i class="fab fa-reddit"></i>
            </span>
            <span>Reddit</span>
          </a>
        </div>
      </div>
    </div>
        -->

        <main>
            <div class="privacy-notice">
                <h3>üõ°Ô∏è Your Privacy is Protected</h3>
                <p>All conversion happens locally in your browser. Your data never leaves your device and is not sent to any servers. This tool is open source under the GPL license and can be verified.</p>

                <details class="verification-details">
                    <summary>üîç How to Verify Client-Side Processing</summary>
                    <div class="verification-content">
                        <h4>Easy Verification Methods:</h4>
                        <ol>
                            <li><strong>Network Tab Test:</strong> Open Developer Tools (F12) ‚Üí Network tab ‚Üí Upload a file. You'll see NO requests to external servers during conversion.</li>
                            <li><strong>Offline Test:</strong> Disconnect from the internet after loading this page. The tool will still work perfectly.</li>
                            <li><strong>Source Code:</strong> All code is <a href="https://github.com/benjaminoakes/pocket-to-wallabag/" target="_blank">open source on GitHub</a> - inspect it yourself!</li>
                            <li><strong>Local File Test:</strong> Download the files and open index.html directly in your browser using file:// protocol.</li>
                        </ol>
                        <p><em>These tests prove your data never leaves your device.</em></p>
                    </div>
                </details>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <div class="upload-icon">üìÅ</div>
                    <h3>Drop your Pocket export ZIP file here</h3>
                    <p>or <button class="browse-btn" id="browseBtn">browse files</button></p>
                    <input type="file" id="fileInput" accept=".zip" hidden>
                </div>
            </div>

            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Processing...</p>
            </div>

            <div class="results-section" id="resultsSection" style="display: none;">
                <h3>Conversion Complete!</h3>
                <div class="stats" id="statsDisplay"></div>
                <div class="format-explanation">
                    <p><strong>üìÑ Format:</strong> Instapaper CSV (compatible with Wallabag import)</p>
                    <p><strong>üí° Tip:</strong> Use Wallabag's "Import from Instapaper" feature to import this file</p>
                </div>
                <button class="download-btn" id="downloadBtn">Download Converted CSV</button>
            </div>
        </main>
    </div>

    <script src="lib/jszip.min.js"></script>
    <script src="js/zip-handler.js"></script>
    <script src="js/converter.js"></script>
    <script src="js/ui.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Check for native share support and show appropriate buttons
      if (navigator.share) {
        document.getElementById('native-share-btn').style.display = 'inline-flex';
        document.getElementById('native-share-btn-bottom').style.display = 'inline-flex';
      } else {
        document.getElementById('copy-share-btn').style.display = 'inline-flex';
        document.getElementById('copy-share-btn-bottom').style.display = 'inline-flex';
      }
    })

  // Native share function
  function shareNatively() {
    if (navigator.share) {
      navigator.share({
        title: 'Get Off Pocket: Open Source Alternatives',
        text: 'Comprehensive guide to open source read-it-later tools and hosting options. Compare Wallabag, Readeck, Linkding, Shiori, and more.',
        url: window.location.href
      }).then(() => {
        gtag('event', 'share', {
          'method': 'native',
          'content_type': 'guide',
          'item_id': 'open_source_alternatives'
        });
      }).catch((error) => {
        console.log('Error sharing:', error);
        // Fallback to copy
        copyToShare();
      });
    } else {
      copyToShare();
    }
  }

  // Copy to clipboard function
  function copyToShare() {
    const url = window.location.href;

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(url).then(() => {
        showCopyNotification('Link copied to clipboard!');
        gtag('event', 'share', {
          'method': 'copy',
          'content_type': 'guide',
          'item_id': 'open_source_alternatives'
        });
      }).catch(() => {
        fallbackCopyToClipboard(url);
      });
    } else {
      fallbackCopyToClipboard(url);
    }
  }

  // Fallback copy method for older browsers
  function fallbackCopyToClipboard(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
      document.execCommand('copy');
      showCopyNotification('Link copied to clipboard!');
      gtag('event', 'share', {
        'method': 'copy_fallback',
        'content_type': 'guide',
        'item_id': 'open_source_alternatives'
      });
    } catch (err) {
      showCopyNotification('Please copy this link manually: ' + text);
    }

    document.body.removeChild(textArea);
  }

  // Show copy notification
  function showCopyNotification(message) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = 'notification is-success is-light';
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '1000';
    notification.style.maxWidth = '300px';
    notification.innerHTML = `
      <button class="delete" onclick="this.parentElement.remove()"></button>
      ${message}
    `;

    document.body.appendChild(notification);

    // Auto-remove after 3 seconds
    setTimeout(() => {
      if (notification.parentElement) {
        notification.remove();
      }
    }, 3000);
  }
    </script>
</body>
</html>
