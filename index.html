<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket to Wallabag Converter</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Basic styles for the new elements for visibility */
        .share-btn {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            color: #3273dc; /* Default link color */
            font-weight: bold;
        }
        .share-btn:hover {
            text-decoration: underline;
        }
        .promotion-section {
            border-top: 2px solid #dbdbdb;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            text-align: left;
        }
        .promotion-section h3 {
            font-size: 1.5em;
            margin-bottom: 0.5rem;
        }
        .promotion-section p {
            margin-bottom: 1rem;
        }
        .promo-code {
            background-color: #f5f5f5;
            border: 1px dashed #dbdbdb;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
        }
        .promo-cta-btn {
            display: inline-block;
            background-color: #23d160;
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            text-align: center;
        }
        .promo-cta-btn:hover {
            background-color: #20bc56;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pocket to Wallabag Converter</h1>
            <p>A <a href="https://getoffpocket.com/">getoffpocket.com</a> project</p>
            <p>Convert your Pocket export to Wallabag-compatible format</p>
            <div class="format-info">
                <span class="format-badge">üìÑ Exports as Instapaper CSV format</span>
                <span class="compatibility-note">Compatible with Wallabag import</span>
            </div>
            <div class="privacy-badges">
                <span class="badge privacy-badge">üîí 100% Client-Side Processing</span>
                <span class="badge opensource-badge">üìñ Open Source (üêô <a href="https://github.com/benjaminoakes/pocket-to-wallabag/">GitHub</a>, 3Ô∏è‚É£ <a href="LICENSE.txt">GPLv3</a>)</span>
                <a id="shareletteBtn" class="badge share-btn" href="#" target="_blank">üîó Share</a>
            </div>
        </header>

        <main>
            <div class="privacy-explanation">
                <h3>üõ°Ô∏è Your Privacy is Protected</h3>
                <p>All conversion happens locally in your browser. Your data never leaves your device and is not sent to any servers. This tool is open source under the GPL license and can be verified.</p>

                <details class="verification-details">
                    <summary>üîç How to Verify Client-Side Processing</summary>
                    <div class="verification-content">
                        <h4>Easy Verification Methods:</h4>
                        <ol>
                            <li><strong>Network Tab Test:</strong> Open Developer Tools (F12) ‚Üí Network tab ‚Üí Upload a file. You'll see NO requests to external servers during conversion.</li>
                            <li><strong>Offline Test:</strong> Disconnect from the internet after loading this page. The tool will still work perfectly.</li>
                            <li><strong>Source Code:</strong> All code is <a href="https://github.com/benjaminoakes/pocket-to-wallabag/" target="_blank">open source on GitHub</a> - inspect it yourself!</li>
                            <li><strong>Local File Test:</strong> Download the files and open index.html directly in your browser using file:// protocol.</li>
                        </ol>
                        <p><em>These tests prove your data never leaves your device.</em></p>
                    </div>
                </details>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <div class="upload-icon">üìÅ</div>
                    <h3>Drop your Pocket export ZIP file here</h3>
                    <p>or <button class="browse-btn" id="browseBtn">browse files</button></p>
                    <input type="file" id="fileInput" accept=".zip" hidden>
                </div>
            </div>

            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Processing...</p>
            </div>

            <div class="results-section" id="resultsSection" style="display: none;">
                <h3>Conversion Complete!</h3>
                <div class="stats" id="statsDisplay"></div>
                <div class="format-explanation">
                    <p><strong>üìÑ Format:</strong> Instapaper CSV (compatible with Wallabag import)</p>
                    <p><strong>üí° Tip:</strong> Use Wallabag's "Import from Instapaper" feature to import this file</p>
                </div>
                <button class="download-btn" id="downloadBtn">Download Converted CSV</button>

                <div class="promotion-section">
                    <h3>üöÄ Supercharge Your Wallabag Experience!</h3>
                    <p>Tired of self-hosting? Get fast, managed Wallabag hosting with <strong>CloudBreak</strong>. We handle the updates, security, and maintenance so you can focus on reading.</p>
                    <p>As a Pocket to Wallabag user, get <strong>$2 off</strong> your subscription with the coupon code: <span class="promo-code">P2WC</span></p>
                    <a href="https://cloudbreak.app/wallabag?utm_medium=referral&utm_source=p2wc&rby=p2wc" target="_blank" class="promo-cta-btn">Sign Up and Claim Your Discount</a>
                </div>
            </div>
        </main>
    </div>

    <script src="lib/jszip.min.js"></script>
    <script src="js/zip-handler.js"></script>
    <script src="js/converter.js"></script>
    <script src="js/ui.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- Sharelette Button Setup ---
      const shareButton = document.getElementById('shareletteBtn');
      if (shareButton) {
        const url = encodeURIComponent(window.location.href);
        const text = encodeURIComponent('Convert your Pocket export to a Wallabag-compatible format with this free, open-source, and private tool.');
        shareButton.href = `https://sharelette.cloudbreak.app/?url=${url}&text=${text}`;
      }

      // Existing script logic (if any) can remain here.
      // The old share logic has been removed to avoid conflict and focus on the new requirements.
    });

    // NOTE: The previous share and copy functions have been removed as the new Sharelette button handles this.
    // If you need fallback functionality, the original functions can be re-integrated.
    </script>
</body>
</html>
